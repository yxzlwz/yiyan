# 异想之旅亿言项目

**该项目目前已整合到异想之旅新版网页中，此仓库不再更新。**

## 项目简介

本项目的思路来源于[Hitokoto - 一言](https://hitokoto.cn/)，我使用了一个下午的时间基本上完成了复刻，现有句子请求、分类、提交、审核（后两项依赖于异想之旅登录系统）。

以下为本项目相关的地址：

- 主页：[https://yiyan.yixiangzhilv.com/](https://yiyan.yixiangzhilv.com/)
- 提交句子：[https://yiyan.yixiangzhilv.com/user/new](https://yiyan.yixiangzhilv.com/user/new)
- 开源地址：[https://github.com/Danny-Yxzl/yiyan](https://github.com/Danny-Yxzl/yiyan)
- 开源地址（镜像）：[https://gitee.com/yxzlwz/yiyan](https://gitee.com/yxzlwz/yiyan)

## 项目开源

由于**目前异想之旅服务器并不稳定**，加之完整版本由于设计缺陷目前无法开启多线程或多进程，另外提交和审核部分依赖异想之旅登录系统和留言板系统较难供大家适配，因此我们开源了一个可以完成句子获取的简易版本。

该版本每次启动时会与GitHub上的data目录进行同步保证数据处于最新状态。前期我们的句子库并不全，您可以选择使用来自Hitokoto的数据（使用方法详见 **修改配置文件** 部分）

预览地址（完整版，非开源版）：[https://yiyan.yixiangzhilv.com/]()

## 贡献句子

作为一个数据共享平台，我们需要大量的优质句子输入素材库。我们会持之以恒地做这件事，也恳请您帮助我们提交一些您原创或搜集到的句子：[提交句子 - 异想之旅亿言](https://yiyan.yixiangzhilv.com/user/new)。

#### 各类别的简称对照和解释

- a 原创：一定是**自己**原创的句子
- b 网络：来源于各网络论坛、社交平台的句子
- c 歌曲：歌词
- d 文学：出现在出版物上或较为知名的网络发表文学的句子
- e 影视：电影或电视剧的台词, 包括动漫
- f 游戏：来自游戏的角色台词, 或其他游戏相关内容
- g 哲学：一切牵扯哲学的内容, 包括但不限于哲学、情感哲学
- h 诗词：中国的古诗词不说了
- i 名言：名人名言
- j 抖机灵：一个简短的冷笑话或新奇想法，或者单纯皮一下！
- y 其它：认为不属于以上任意一项的

#### 对于一些常见内容的分类、来源和作者的填写意见

- 歌曲评论区留言：分类为 b网络 ，来源填写评论区所在APP（如“QQ音乐”或“网易云音乐”），作者填写评论发布者的昵称
- 出自出版物的句子必须要有来源和作者
- 已知名字不明作者的诗词，可在作者处填写形如“明代诗人”的描述或不填；不明作者和名称的诗词，请在作者除填写形如“明代诗人”“明清文人”的描述
- 分类 e影视 的句子必须要有来源，作者可填写编剧、导演或台词属于的角色在剧中的名字，亦可留空
- 中国作品请加书名号（包括但不限于出版物、歌曲、影视等），其它语言作品不加书名号。请注意，此处以国籍而非语言区分。

#### 其它提交要求

使用自己身边人的句子，特别是提交到原创分类时请确保经得本人同意。

任何违规和侵权请与我们联系。

对于错填格式或随意分类的，质量中等偏低的句子将不予通过，质量中等偏高的句子将会由管理员修改后发布。在不损害用户法律权利的情况下，异想之旅有权对提交的句子内容进行修改。

## 快速上手

1. 确保环境中已经安装 python3.6+ 和 pip3
2. clone项目到本地： `git clone https://github.com/Danny-Yxzl/yiyan.git`
3. 使用pip安装依赖： `pip3 install flask flask_cors requests`
4. 根据自己的需要修改配置文件 `config.py`
5. 使用 `python3 app.py` 或 `uwsgi uwsgi.ini` 命令启动服务

程序默认监听 `0.0.0.0:596` 端口，若想要监听其它端口，请根据自己的启动方式自行修改 `app.py` （最后一行）或 `uwsgi.ini` （很明显的位置）

## 修改配置文件

- `data_from` ：可选值为 `local` 或 `remote` ，分别表示从本地或远端获取句子数据。程序根据您的设定将分别使用 `dir` 或 `url` 中设置的数据文件路径。
- `dir` ：若 `data_from` 值为 `local` 需填写，表示本地data文件夹的位置
- `url` ：若 `data_from` 值为 `remote` 需填写，表示远端data文件夹的请求路径
- `cate` ：目前使用的句子分类代码，也就是目前存在的配置文件名称。

此处举例一个例子方便理解。

若变量设置如下：

```python
data_from = "remote"
url = "https://cdn.jsdelivr.net/gh/Danny-Yxzl/yiyan@master/data/"
cate = "abc"
```

则程序会请求 `https://cdn.jsdelivr.net/gh/Danny-Yxzl/yiyan@master/data/` 目录下的 `a.json` `b.json` `c.json` 三个文件，并分别作为 "原创" "网络" "歌曲" 三个分类的数据保存。

由于只有这三个数据，因此用户请求呼指定请求参数的 `type` 字段时，程序只会返回这三个分类的数据。若用户指定了这三个分类之外的类别，则程序会报错。

分类代码与名称映射详见下表：

```json
{
    "a": "原创",
    "b": "网络",
    "c": "歌曲",
    "d": "文学",
    "e": "影视",
    "f": "游戏",
    "g": "哲学",
    "h": "诗词",
    "i": "名言",
    "j": "抖机灵",
    "y": "其它",
    "z": "未知"
}
```

关于具体的分类标准，请参见上文 **贡献句子** 部分的说明。

## 用户请求

对于页面，我们有路径 `/` 来获取展示页；对于接口，我们有接口 `/get` 来获取数据。

使用 `GET` 方法请求页面  `/`，程序会渲染并返回 `templates/index.html `模板文件。其中，程序渲染时会写入随机的句子；网页前端会通过异想之旅的接口获取必应壁纸作为网页背景。特别说明的是，由于网页字体文件较大，您可以选择删去 `templates/index.html `第11-16行的 `style` 定义来去除字体，加快网页响应。

使用 `GET` 或 `POST` 方法请求接口 `/get` ，可选传递参数 `uuid` 和 `type` （GET查询字符串或POST表单均可）。其中 `uuid` 的优先级更高。 `uuid` 指定获取句子的uuid值，可以精准获取句子信息； `type` 指定请求的句子分类，可以填写多个（可选值、格式与 **修改配置文件** 部分中的 `cate` 变量完全相同），将从所选分类中随机获取句子，理论上是获取到每个类别的概率相等，可能出现某个类别由于句子少导致单句概率高的问题；若均不填写则随机返回一句。

返回数据为 `json` `object` 格式，包含有如下信息：

- `content` ：句子内容
- `created_at` ：句子被提交时被记录下的秒级时间戳
- `creator` ：提交用户的用户用户名
- `from` ：句子来源
- `from_who` ：句子作者（作者非提交者）
- `length` ：句子的字符数，非极特殊情况下取值不超过40
- `type` ：句子的分类，详情参见上文 **贡献句子** 部分的说明详情参考 [项目文档](https://blog.yixiangzhilv.com/article/39)
- `uuid` ：句子的uuid信息（通常为 `content` 的md5值），可通过记录此值在未来不通过随机重新找到该句子，或向我们准确描述对于某个句子的反馈。

## 帮助我们

我们再次诚挚地邀请您根据上文提到的 **贡献句子** 部分内容来向我们提交优质的句子。

如果您愿意申请管理员，请用注册异想之旅账号的邮箱与我们联系申请，我们会尽快处理。

如果您愿意赞助我们资金或服务器，那就再好不过了。

## 联系方式

您可以通过微信公众号 异想之旅 或邮箱地址 [mail@yixiangzhilv.com](mailto:mail@yixiangzhilv.com) 联系到我们。
